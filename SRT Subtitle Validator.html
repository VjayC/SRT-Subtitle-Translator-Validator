<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRT Subtitle Validator</title>
    <style>
        /* --- THEME COLORS (NEW) --- */
        :root {
            /* Dark Mode (Default) */
            --bg-color: #000000;
            --container-bg: #0a0a0a;
            --container-border: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #ccc;
            --text-subtle: #666;
            --shadow-color: rgba(0, 0, 0, 0.8);
            --button-bg: #1a1a1a;
            --button-border: #333;
            --button-text: #888;
            --button-hover-bg: #222;
            --button-hover-border: #444;
            --button-hover-text: #aaa;
            --results-bg: #0f0f0f;
            --results-list-bg: #050505;
            --scrollbar-thumb: #333;
            --scrollbar-thumb-hover: #444;
        }

        @media (prefers-color-scheme: light) {
            :root {
                /* Light Mode Overrides */
                --bg-color: #f5f5f7;
                --container-bg: #ffffff;
                --container-border: #d2d2d7;
                --text-primary: #1d1d1f;
                --text-secondary: #333;
                --text-subtle: #6e6e73;
                --shadow-color: rgba(0, 0, 0, 0.1);
                --button-bg: #f5f5f7;
                --button-border: #d2d2d7;
                --button-text: #555;
                --button-hover-bg: #e8e8ed;
                --button-hover-border: #b2b2b7;
                --button-hover-text: #333;
                --results-bg: #f7f7f7;
                --results-list-bg: #ffffff;
                --scrollbar-thumb: #c1c1c1;
                --scrollbar-thumb-hover: #a8a8a8;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: var(--container-bg);
            border: 1px solid var(--container-border);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 20px 60px var(--shadow-color);
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: var(--text-subtle);
            margin-bottom: 40px;
            font-size: 14px;
        }

        .file-input-container {
            margin-bottom: 30px;
        }

        .file-input-wrapper {
            position: relative;
            margin-bottom: 25px;
        }

        .file-label {
            display: block;
            margin-bottom: 25px;
            color: var(--text-subtle);
            font-size: 14px;
            font-weight: 500;
            padding-left: 4px;
        }

        .file-input {
            display: none;
        }

        .file-button {
            width: 100%;
            padding: 16px 20px;
            background: var(--button-bg);
            border: 2px dashed var(--button-border);
            border-radius: 12px;
            color: var(--button-text);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 15px;
            /* --- FIX for long filenames --- */
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-button:hover {
            background: var(--button-hover-bg);
            border-color: var(--button-hover-border);
            color: var(--button-hover-text);
        }

        .file-button.selected {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 2px solid #667eea;
            color: var(--text-primary);
        }

        .compare-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .compare-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .compare-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results {
            margin-top: 40px;
            padding: 20px;
            background: var(--results-bg);
            border-radius: 12px;
            border: 1px solid var(--container-border);
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .results.show { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .success { color: #4ade80; font-weight: 500; }
        .error { color: #f87171; font-weight: 500; }
        .warning { color: #fbbf24; font-weight: 500; }

        .mismatch-list {
            margin-top: 20px;
            padding: 15px;
            background: var(--results-list-bg);
            border-radius: 8px;
            border: 1px solid var(--container-border);
        }

        .mismatch-item {
            margin-bottom: 12px;
            padding: 10px;
            background: var(--container-bg);
            border-radius: 6px;
            border-left: 3px solid #f87171;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .mismatch-range { color: #f87171; font-weight: bold; }
        .stats { display: flex; justify-content: space-around; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--container-border); }
        .stat-item { text-align: center; }
        .stat-value { font-size: 24px; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 12px; color: var(--text-subtle); margin-top: 5px; }

        .results::-webkit-scrollbar { width: 8px; }
        .results::-webkit-scrollbar-track { background: var(--container-bg); border-radius: 4px; }
        .results::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius: 4px; }
        .results::-webkit-scrollbar-thumb:hover { background: var(--scrollbar-thumb-hover); }

        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid var(--container-border); border-radius: 50%; border-top-color: #667eea; animation: spin 1s ease-in-out infinite; margin-right: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>SRT Subtitle Validator</h1>
        <p class="subtitle">Validate timestamps, check for foreign characters, and ensure file integrity.</p>
        
        <div class="file-input-container">
            <div class="file-input-wrapper">
                <label class="file-label">English SRT File (Reference)</label>
                <input type="file" id="file1" class="file-input" accept=".srt">
                <label for="file1" class="file-button" id="file1-button">
                    üìÑ Choose English SRT file...
                </label>
            </div>
            
            <div class="file-input-wrapper">
                <label class="file-label">Telugu SRT File (To Check)</label>
                <input type="file" id="file2" class="file-input" accept=".srt">
                <label for="file2" class="file-button" id="file2-button">
                    üìÑ Choose Telugu SRT file...
                </label>
            </div>
        </div>
        
        <button id="compare-btn" class="compare-button" disabled>
            Validate Files
        </button>
        
        <div id="results" class="results"></div>
    </div>

    <script>
        let file1Data = null;
        let file2Data = null;

        function parseSRT(content) {
            const subtitles = [];
            if (!content) return subtitles; // Handle null content
            const blocks = content.trim().split(/\n\s*\n/);
            
            for (const block of blocks) {
                const lines = block.trim().split('\n');
                if (lines.length < 2) continue;
                
                const indexLine = lines[0];
                const timecodeLine = lines.length > 1 ? lines[1] : '';
                const textLines = lines.slice(2);

                const index = parseInt(indexLine);
                
                if (!isNaN(index) && timecodeLine.includes('-->')) {
                    subtitles.push({
                        index: index,
                        timecode: timecodeLine.trim(),
                        text: textLines.join('\n')
                    });
                }
            }
            return subtitles;
        }

        document.getElementById('file1').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    file1Data = parseSRT(event.target.result);
                    document.getElementById('file1-button').classList.add('selected');
                    document.getElementById('file1-button').textContent = `‚úî ${file.name}`;
                    checkCanCompare();
                    e.target.value = null;
                };
                reader.readAsText(file);
            }
        });

        document.getElementById('file2').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    file2Data = parseSRT(event.target.result);
                    document.getElementById('file2-button').classList.add('selected');
                    document.getElementById('file2-button').textContent = `‚úî ${file.name}`;
                    checkCanCompare();
                    e.target.value = null;
                };
                reader.readAsText(file);
            }
        });

        function checkCanCompare() {
            const compareBtn = document.getElementById('compare-btn');
            if (file1Data && file2Data) {
                compareBtn.disabled = false;
            }
        }

        document.getElementById('compare-btn').addEventListener('click', function() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading"></div> Analyzing...';
            results.classList.add('show');
            setTimeout(() => {
                compareFiles();
            }, 500);
        });

        /**
        * --- MODIFIED Language Script Checker ---
        * Now allows additional specified characters and common extended Latin letters.
        */
        function checkLanguageScript(subtitles) {
            const errors = [];
            // U+00A0 to U+00FF is the Latin-1 Supplement block (covers √©, √±, ¬£, etc.)
            const isLatinSupplement = (code) => code >= 0x00A0 && code <= 0x00FF;
            const isBasicLatin = (code) => code >= 0x0020 && code <= 0x007E;
            const isTelugu = (code) => code >= 0x0C00 && code <= 0x0C7F;
            const isAllowedSpecial = (code) => [
                0x2018, 0x2019, 0x201C, 0x201D, // Quotes
                0x200C, // Zero-Width Non-Joiner
                0x2014  // Em Dash
            ].includes(code);
            const isNewline = (code) => code === 0x000A;
            const isCarriageReturn = (code) => code === 0x000D;

            for (const sub of subtitles) {
                for (let i = 0; i < sub.text.length; i++) {
                    const char = sub.text[i];
                    const code = char.charCodeAt(0);
                    if (!(isBasicLatin(code) || isLatinSupplement(code) || isTelugu(code) || isAllowedSpecial(code) || isNewline(code) || isCarriageReturn(code))) {
                        errors.push({
                            index: sub.index,
                            line: sub.text.replace(/\n/g, ' '),
                            invalidChar: char,
                            unicode: `U+${code.toString(16).toUpperCase().padStart(4, '0')}`
                        });
                        break; 
                    }
                }
            }
            return errors;
        }

        function compareFiles() {
            const results = document.getElementById('results');
            
            if (file1Data.length !== file2Data.length) {
                results.innerHTML = `
                    <div class="error">‚ùå Error: Subtitle count mismatch!</div>
                    <div class="mismatch-list">
                        <p>English SRT: ${file1Data.length} subtitles</p>
                        <p>Telugu SRT: ${file2Data.length} subtitles</p>
                        <p style="margin-top: 10px; color: var(--text-subtle);">Files must have the same number of subtitles to compare timestamps.</p>
                    </div>
                `;
                return;
            }
            
            let timestampHtml = '';
            const mismatches = [];
            let currentRange = null;
            
            for (let i = 0; i < file1Data.length; i++) {
                if (!file1Data[i] || !file2Data[i] || file1Data[i].timecode !== file2Data[i].timecode) {
                     if (!file1Data[i] || !file2Data[i]) continue; // Skip if parsing failed for an entry
                    if (currentRange && currentRange.end === i - 1) {
                        currentRange.end = i;
                        currentRange.endIndex = file1Data[i].index;
                    } else {
                        if (currentRange) mismatches.push(currentRange);
                        currentRange = { start: i, end: i, startIndex: file1Data[i].index, endIndex: file1Data[i].index };
                    }
                } else {
                    if (currentRange) {
                        mismatches.push(currentRange);
                        currentRange = null;
                    }
                }
            }
            if (currentRange) mismatches.push(currentRange);
            
            if (mismatches.length === 0) {
                timestampHtml = `
                    <div class="success">‚úÖ Perfect match! All timestamps are synchronized.</div>
                    <div class="stats">
                        <div class="stat-item"><div class="stat-value">${file1Data.length}</div><div class="stat-label">Total Subtitles</div></div>
                        <div class="stat-item"><div class="stat-value">0</div><div class="stat-label">Mismatches</div></div>
                        <div class="stat-item"><div class="stat-value">100%</div><div class="stat-label">Sync Rate</div></div>
                    </div>
                `;
            } else {
                const mismatchCount = mismatches.reduce((acc, range) => acc + (range.end - range.start + 1), 0);
                const syncRate = ((file1Data.length - mismatchCount) / file1Data.length * 100).toFixed(1);
                timestampHtml = `<div class="error">‚ùå Timestamp mismatches detected!</div><div class="warning" style="margin-top: 10px;">Found ${mismatches.length} mismatch range(s):</div><div class="mismatch-list">`;
                for (const range of mismatches) {
                    if (range.start === range.end) {
                        timestampHtml += `<div class="mismatch-item"><span class="mismatch-range">Subtitle #${range.startIndex}</span><br>English: ${file1Data[range.start].timecode}<br>Telugu: ${file2Data[range.start].timecode}</div>`;
                    } else {
                        timestampHtml += `<div class="mismatch-item"><span class="mismatch-range">Subtitles #${range.startIndex} to #${range.endIndex}</span><br>Range affects ${range.end - range.start + 1} subtitle(s)</div>`;
                    }
                }
                timestampHtml += `</div><div class="stats">
                        <div class="stat-item"><div class="stat-value">${file1Data.length}</div><div class="stat-label">Total Subtitles</div></div>
                        <div class="stat-item"><div class="stat-value" style="color: #f87171;">${mismatchCount}</div><div class="stat-label">Mismatches</div></div>
                        <div class="stat-item"><div class="stat-value">${syncRate}%</div><div class="stat-label">Sync Rate</div></div>
                    </div>`;
            }

            let languageHtml = '';
            const languageErrors = checkLanguageScript(file2Data);
            if (languageErrors.length > 0) {
                languageHtml = `<div class="warning" style="margin-top: 30px; border-top: 1px solid var(--container-border); padding-top: 20px;">‚ö†Ô∏è Foreign Script Detected!</div><div class="mismatch-list">`;
                for (const err of languageErrors) {
                    languageHtml += `<div class="mismatch-item" style="border-left-color: #fbbf24;"><strong>Subtitle #${err.index}:</strong> Found invalid character '<strong>${err.invalidChar}</strong>' (${err.unicode})<br><span style="color: var(--text-subtle);">Line: "${err.line}"</span></div>`;
                }
                languageHtml += `</div>`;
            }
            results.innerHTML = timestampHtml + languageHtml;
        }
    </script>
</body>
</html>